<!DOCTYPE html>
<html>
<head>
    <title>How It Works - Chaos-Based Cryptography</title>
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Sora', sans-serif;
            background: linear-gradient(135deg, #0f0f1a, #1a1a2e);
            color: #eee;
        }
        .container {
            background: rgba(51, 51, 51, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(255,0,0,0.1);
            margin-bottom: 20px;
            border: 1px solid #555;
        }
        h1, h2, h3 { color: #ff4d4d; }
        .button {
            display: inline-block;
            background-color: #7f8c8d;
            color: white;
            padding: 15px 30px;
            margin: 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            font-size: 16px;
        }
        .button:hover {
            background-color: #95a5a6;
        }
        .explanation {
            text-align: left;
            padding: 20px;
        }
        .graph {
            margin: 20px 0;
            padding: 10px;
            border: 1px solid #555;
            border-radius: 4px;
        }
        .code-block {
            background-color: #444;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
            color: #eee;
        }
        .controls {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        .controls label {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .controls input[type="range"] {
            width: 150px;
        }
    </style>
</head>
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <nav class="nav">
        <div class="logo">CHAOSCRYPT</div>
        <div class="nav-links">
            <a href="/encrypt">Encrypt</a>
            <a href="/decrypt">Decrypt</a>
            <a href="/how-it-works">Learn More</a>
        </div>
    </nav>
    <div class="container explanation">
        <h2>How Does It Work?</h2>

        <h3>1. The Logistic Map</h3>
        <p>At the heart of our encryption system is the logistic map, a chaotic mathematical function:</p>
        <div class="code-block">x_{n+1} = r * x_n * (1 - x_n)</div>
        <p>Where:</p>
        <ul>
            <li>r â‰ˆ 4 (we use 3.99999)</li>
            <li>x_n is a value between 0 and 1</li>
        </ul>
        <div id="logisticPlot" class="graph"></div>

        <h3>2. Encryption Process</h3>
        <p>The encryption process follows these steps:</p>
        <ol>
            <li>Each character in the input message is converted to its ASCII value</li>
            <li>The logistic map generates a unique chaos value for each character</li>
            <li>The chaos value is used to shift the ASCII value (modulo 256)</li>
            <li>In double encryption mode, this process is repeated with a second seed</li>
        </ol>

        <h3>3. Security Features</h3>
        <ul>
            <li><strong>Sensitivity to Initial Conditions:</strong> Even a tiny change in the seed value produces completely different results</li>
            <li><strong>Deterministic Chaos:</strong> The system is deterministic yet unpredictable without the correct seed</li>
            <li><strong>Double Encryption Option:</strong> Adds an extra layer of security with a second chaotic sequence</li>
        </ul>

        <div id="sensitivityPlot" class="graph"></div>

        <h3>4. Bifurcation Diagram</h3>
        <p>The logistic map exhibits different behaviors based on the value of r. This interactive diagram shows how the system transitions from stable to chaotic behavior:</p>
        <div class="controls">
            <label>Points: <input type="range" id="pointsSlider" min="100" max="1000" value="500" /></label>
            <label>Iterations: <input type="range" id="iterationsSlider" min="50" max="200" value="100" /></label>
        </div>
        <div id="bifurcationPlot" class="graph"></div>
    </div>

    <script>
        // Interactive logistic map visualization
        function createInteractiveLogisticMap() {
            const x = Array.from({length: 100}, (_, i) => i/99);
            const r = 3.99999;
            const y = x.map(xi => r * xi * (1 - xi));

            const trace1 = {
                x: x,
                y: y,
                mode: 'lines',
                name: 'Logistic Map',
                line: {
                    color: '#ff3366',
                    width: 2
                }
            };

            const identityLine = {
                x: [0, 1],
                y: [0, 1],
                mode: 'lines',
                name: 'y = x',
                line: {
                    color: '#666',
                    width: 1,
                    dash: 'dash'
                }
            };

            let currentPoint = {
                x: [0.2],
                y: [r * 0.2 * (1 - 0.2)],
                mode: 'markers',
                name: 'Current Point',
                marker: {
                    size: 10,
                    color: '#2ecc71'
                }
            };

            const layout = {
                title: 'Interactive Logistic Map',
                xaxis: { 
                    title: 'x_n',
                    range: [0, 1],
                    gridcolor: '#444',
                    zerolinecolor: '#666'
                },
                yaxis: { 
                    title: 'x_{n+1}',
                    range: [0, 1],
                    gridcolor: '#444',
                    zerolinecolor: '#666'
                },
                plot_bgcolor: '#333',
                paper_bgcolor: '#333',
                font: { color: '#fff' },
                showlegend: true,
                legend: {
                    font: { color: '#fff' }
                },
                updatemenus: [{
                    type: 'buttons',
                    showactive: false,
                    x: 0.1,
                    y: 1.1,
                    buttons: [{
                        label: 'Play',
                        method: 'animate',
                        args: [null, {
                            fromcurrent: true,
                            frame: {duration: 50},
                            mode: 'immediate',
                            transition: {duration: 50}
                        }]
                    }]
                }]
            };

            Plotly.newPlot('logisticPlot', [trace1, identityLine, currentPoint], layout);

            let x_n = 0.2;
            function animate() {
                x_n = r * x_n * (1 - x_n);
                const update = {
                    x: [[x_n]],
                    y: [[r * x_n * (1 - x_n)]]
                };
                Plotly.animate('logisticPlot', {
                    data: [{}, {}, update],
                    traces: [2],
                    layout: {}
                }, {
                    transition: {duration: 0},
                    frame: {duration: 50}
                });
                requestAnimationFrame(animate);
            }
            animate();
        }

        // Enhanced bifurcation diagram
        function createBifurcationDiagram() {
            const rValues = [];
            const xValues = [];
            let points = 1000;
            let iterations = 100;

            for(let r = 2.8; r <= 4; r += (1.2/points)) {
                let x = 0.5;
                for(let i = 0; i < 100; i++) {
                    x = r * x * (1 - x);
                }
                
                const localIterations = r > 3.57 ? Math.floor(iterations * 0.3) : iterations;
                for(let i = 0; i < localIterations; i++) {
                    x = r * x * (1 - x);
                    rValues.push(r);
                    xValues.push(x);
                }
            }

            const trace = {
                x: rValues,
                y: xValues,
                mode: 'markers',
                type: 'scattergl',
                marker: {
                    size: 1,
                    opacity: 0.5,
                    color: xValues,
                    colorscale: 'Viridis'
                }
            };

            const layout = {
                title: 'Interactive Bifurcation Diagram',
                xaxis: { 
                    title: 'r parameter',
                    range: [2.8, 4]
                },
                yaxis: { 
                    title: 'x values',
                    range: [0, 1]
                },
                plot_bgcolor: '#333',
                paper_bgcolor: '#333',
                font: { color: '#fff' },
                dragmode: 'zoom',
                hovermode: 'closest'
            };

            const config = {
                responsive: true,
                scrollZoom: true,
                displayModeBar: true,
                modeBarButtonsToAdd: ['drawline', 'eraseshape']
            };

            Plotly.newPlot('bifurcationPlot', [trace], layout, config);
        }

        // Sensitivity visualization with interactive initial conditions
        function createSensitivityPlot() {
            let x1 = 0.2;
            let x2 = 0.201;
            const r = 3.99999;
            const iterations = 50;
            
            const trace1 = {
                y: Array.from({length: iterations}, (_, i) => {
                    x1 = r * x1 * (1 - x1);
                    return x1;
                }),
                mode: 'lines+markers',
                name: 'Initial x = 0.2',
                line: {color: '#ff3366'},
                marker: {size: 5}
            };

            const trace2 = {
                y: Array.from({length: iterations}, (_, i) => {
                    x2 = r * x2 * (1 - x2);
                    return x2;
                }),
                mode: 'lines+markers',
                name: 'Initial x = 0.201',
                line: {color: '#2ecc71'},
                marker: {size: 5}
            };

            const layout = {
                title: 'Interactive Sensitivity Analysis',
                xaxis: {
                    title: 'Iteration',
                    gridcolor: '#444'
                },
                yaxis: {
                    title: 'Value',
                    gridcolor: '#444'
                },
                plot_bgcolor: '#333',
                paper_bgcolor: '#333',
                font: {color: '#fff'},
                showlegend: true,
                legend: {font: {color: '#fff'}},
                updatemenus: [{
                    y: 1.1,
                    x: 0.1,
                    yanchor: 'top',
                    buttons: [{
                        method: 'restyle',
                        args: ['visible', [true, true]],
                        label: 'Both'
                    }, {
                        method: 'restyle',
                        args: ['visible', [true, false]],
                        label: 'Path 1'
                    }, {
                        method: 'restyle',
                        args: ['visible', [false, true]],
                        label: 'Path 2'
                    }]
                }]
            };

            Plotly.newPlot('sensitivityPlot', [trace1, trace2], layout);
        }

        // Initialize all plots
        createInteractiveLogisticMap();
        createBifurcationDiagram();
        createSensitivityPlot();
    </script>
    <div style="text-align: center; margin-top: 20px;">
        <a href="/" class="button">Back to Home</a>
    </div>
</body>
</html>